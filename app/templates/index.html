<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ListingLab</title>
    <!-- Flask handles path to css -->
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>

<body> <!-- Header with Search -->
    <script src="https://cdn.jsdelivr.net/npm/hammerjs@2.0.8/hammer.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/luxon@3"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@1"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2"></script>

    <header class="main-header">
        <div class="header-content">
            <div class="header-top-row">
                <h1 class="logo">ListingLab</h1>
                <button id="mobileMenuBtn" class="mobile-menu-btn" aria-label="Toggle menu">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="3" y1="12" x2="21" y2="12"></line>
                        <line x1="3" y1="6" x2="21" y2="6"></line>
                        <line x1="3" y1="18" x2="21" y2="18"></line>
                    </svg>
                </button>
            </div>
            <div class="header-collapsible" id="headerCollapsible">
                <div class="search-box">
                    <div class="search-input-container">
                        <input type="text" id="searchInput" placeholder="Enter product name..." autocomplete="off">
                    </div>

                    <button id="filtersButton" type="button" class="filters-btn unselectable-text">
                        Filters
                    </button>

                    <button id="searchButton" type="button" class="unselectable-text">Search</button>
                </div>
                <div class="header-actions">
                    <div class="history-button-container">
                        <button id="historyButton" type="button" class="history-btn unselectable-text"
                            aria-label="Search history">
                            <svg class="history-icon" width="64px" height="64px" viewBox="0 0 24 24" fill="none"
                                xmlns="http://www.w3.org/2000/svg" stroke="#ffffff">
                                <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                                <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                                <g id="SVGRepo_iconCarrier">
                                    <path
                                        d="M5.52786 16.7023C6.6602 18.2608 8.3169 19.3584 10.1936 19.7934C12.0703 20.2284 14.0409 19.9716 15.7434 19.0701C17.446 18.1687 18.766 16.6832 19.4611 14.8865C20.1562 13.0898 20.1796 11.1027 19.527 9.29011C18.8745 7.47756 17.5898 5.96135 15.909 5.02005C14.2282 4.07875 12.2641 3.77558 10.3777 4.16623C8.49129 4.55689 6.80919 5.61514 5.64045 7.14656C4.47171 8.67797 3.89482 10.5797 4.01579 12.5023M4.01579 12.5023L2.51579 11.0023M4.01579 12.5023L5.51579 11.0023"
                                        stroke="#ffffff" stroke-width="2.4" stroke-linecap="round"
                                        stroke-linejoin="round">
                                    </path>
                                    <path d="M12 8V12L15 15" stroke="#ffffff" stroke-width="2.4" stroke-linecap="round"
                                        stroke-linejoin="round"></path>
                                </g>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <div class="container">
        <!-- Home Page Title (shown when no search results) -->
        <div id="homePage" class="home-page">
            <h1 class="home-title">ListingLab</h1>
        </div>

        <div id="loadingIndicator" class="loading" style="display: none;">
            <div class="spinner"></div>
            <p>Searching...</p>
        </div>

        <div id="errorMessage" class="error-message" style="display: none;"></div>

        <!-- Dashboard Area (shown after successful search) -->
        <div id="dashboardSection" class="dashboard-section" style="display: none;">
            <h2 class="dashboard-title" id="dashboardTitle"></h2>
            <div class="dashboard-layout">
                <!-- Left Sidebar: Metric Cards -->
                <div class="left-sidebar">
                    <div class="metric-card">
                        <div class="metric-label">Total Listings</div>
                        <div class="metric-value" id="metricTotalListings">-</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Average Price</div>
                        <div class="metric-value" id="metricAvgPrice">-</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Median Price</div>
                        <div class="metric-value" id="metricMedianPrice">-</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Min Price</div>
                        <div class="metric-value" id="metricMinPrice">-</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Max Price</div>
                        <div class="metric-value" id="metricMaxPrice">-</div>
                    </div>
                </div>

                <!-- Top Row: Listings by Price with Info Cards -->
                <div class="top-row">
                    <div class="chart-panel dot-plot" id="chartListingsByPrice">
                        <h3 class="chart-title"># Listings by Price</h3>
                        <p class="chart-subtitle">Price distribution</p>
                        <div class="chart-placeholder">
                            <canvas id="listing-by-price"></canvas>
                        </div>
                    </div>
                    <div class="info-card">
                        <h3 class="info-card-title">New vs Used</h3>
                        <div class="info-card-content" id="cardNewVsUsed">
                            <canvas id="new-vs-used-chart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Main Content: Chart Panels (2x2 grid) -->
                <div class="main-content">
                    <div class="chart-panel large" id="chartPriceVsSeller">
                        <h3 class="chart-title">Price vs Seller Score</h3>
                        <p class="chart-subtitle">Scatter plot</p>
                        <div class="chart-placeholder">
                            <canvas id="price-vs-seller-score"></canvas>
                        </div>
                    </div>
                    <div class="chart-panel large" id="chartPriceByDate">
                        <h3 class="chart-title">Price by Listing Date</h3>
                        <p class="chart-subtitle">Time series</p>
                        <div class="chart-placeholder">
                            <canvas id="price-vs-date"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Results Table (existing functionality) -->
        <div id="resultsSection" class="results-section" style="display: none;">
            <div class="results-header">
                <h2>Search Results</h2>
                <button id="downloadButton" class="download-btn unselectable-text">Download All Data</button>
            </div>
            <div id="resultsTableContainer">
                <table id="resultsTable">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Image</th>
                            <th>Title</th>
                            <th>Price</th>
                            <th>Condition</th>
                            <th>Link</th>
                            <th>Seller</th>
                            <th>Category</th>
                        </tr>
                    </thead>
                    <tbody id="resultsTableBody">
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Search History Modal -->
    <div id="historyModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Search History</h2>
                <div class="modal-header-actions">
                    <button id="clearHistoryBtn" class="clear-history-btn" aria-label="Clear all history">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="3 6 5 6 21 6"></polyline>
                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2">
                            </path>
                            <line x1="10" y1="11" x2="10" y2="17"></line>
                            <line x1="14" y1="11" x2="14" y2="17"></line>
                        </svg>
                    </button>
                    <button id="closeHistoryModal" class="close-btn" aria-label="Close">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="modal-body">
                <div id="historyList" class="history-list">
                    <p class="no-history">No search history yet.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Filters Modal -->
    <div id="filtersModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Filters</h2>
                <div class="modal-header-actions">
                    <button id="closeFiltersModal" class="close-btn" aria-label="Close">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="modal-body">
                <form id="filtersForm" class="filters-form">
                    <div class="filter-group">
                        <label for="categorySelect">Category</label>
                        <div class="category-select-container">
                            <select id="categorySelect" aria-label="Select Category"></select>
                        </div>
                    </div>

                    <div class="filter-group">
                        <label>Price Range</label>
                        <div class="price-range-container">
                            <input type="number" id="minPriceInput"
                                onkeydown="if(/^[eE.\+\-]$/.test(event.key)) event.preventDefault();"
                                placeholder="Min Price ($)" min="0" step="0.01">
                            <span class="price-range-separator">-</span>
                            <input type="number" id="maxPriceInput"
                                onkeydown="if(/^[eE.\+\-]$/.test(event.key)) event.preventDefault();"
                                placeholder="Max Price ($)" min="0" step="0.01">
                        </div>
                    </div>

                    <div class="filter-group">
                        <label for="conditionSelect">Condition</label>
                        <div class="condition-select-container">
                            <select id="conditionSelect" aria-label="Select Condition">
                                <option value="">Any</option>
                                <option value="new">New</option>
                                <option value="used">Used</option>
                            </select>
                        </div>
                    </div>

                    <div class="filter-actions-row">
                        <button type="button" id="applyFiltersBtn" class="apply-filters-btn">Apply Filters</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Flask handles path to js -->
    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>

</html>